<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Cover Letter Generator</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    input, textarea, button { margin-bottom: 10px; width: 100%; padding: 8px; }
    .form-group { margin-bottom: 15px; }
    .output { white-space: pre-wrap; border: 1px solid #ccc; padding: 15px; margin-top: 20px; }
    .button-group { display: flex; gap: 10px; margin-top: 10px; }
  </style>
</head>
<body>
  <h1>Cover Letter Generator</h1>
  <div>
    <div class="form-group">
      <label>Applicant Name:</label>
      <input type="text" id="applicantName">
    </div>
    <div class="form-group">
      <label>Residential Address:</label>
      <textarea id="address" rows="2"></textarea>
    </div>
    <div class="form-group">
      <label>Phone Number:</label>
      <input type="text" id="phone">
    </div>
    <div class="form-group">
      <label>Email ID:</label>
      <input type="email" id="email">
    </div>
    <div class="form-group">
      <label>Company Name:</label>
      <input type="text" id="companyName">
    </div>
    <div class="form-group">
      <label>Position Name:</label>
      <input type="text" id="position">
    </div>
    <div class="form-group">
      <label>Job Location:</label>
      <input type="text" id="location">
    </div>
    <div class="form-group">
      <label>Upload Job Description (optional):</label>
      <input type="file" id="jobDescriptionFile" accept=".txt">
    </div>
    <button onclick="generateCoverLetter()">Generate Cover Letter</button>
  </div>

  <div class="output" id="output">
    <h2>Generated Cover Letter:</h2>
    <div id="letter"></div>
    <div class="button-group">
      <button onclick="exportPDF()">Export as PDF</button>
      <button onclick="exportWord()">Export as Word Document</button>
    </div>
  </div>

  <script>
    let finalLetter = "";

    function generateCoverLetter() {
      const name = document.getElementById('applicantName').value;
      const address = document.getElementById('address').value;
      const phone = document.getElementById('phone').value;
      const email = document.getElementById('email').value;
      const company = document.getElementById('companyName').value;
      const position = document.getElementById('position').value;
      const location = document.getElementById('location').value;
      const jdFile = document.getElementById('jobDescriptionFile').files[0];
      const letterDiv = document.getElementById('letter');

      const baseLetter = `
${name}
${address}
Phone: ${phone} | Email: ${email}

${new Date().toLocaleDateString()}

Hiring Manager
${company}
${location}

Dear Hiring Manager,

I am writing to express my interest in the ${position} position at ${company}. With my background and enthusiasm for this role, I believe I can contribute positively to your team.

${jdFile ? "Loading job description insights..." : "I am confident that my experience and skills align well with the requirements of this position. I look forward to the opportunity to contribute to your organization."}

Thank you for considering my application.

Sincerely,
${name}
      `;

      if (jdFile) {
        const reader = new FileReader();
        reader.onload = function (e) {
          const jdText = e.target.result.trim().slice(0, 300);
          finalLetter = baseLetter.replace(
            "Loading job description insights...",
            `I reviewed the job description, and I am particularly drawn to the following aspects:\n\n"${jdText}"\n\nThese resonate with my skills and passion, and I am excited about the opportunity to contribute meaningfully.`
          );
          letterDiv.textContent = finalLetter;
        };
        reader.readAsText(jdFile);
      } else {
        finalLetter = baseLetter;
        letterDiv.textContent = finalLetter;
      }
    }

    function exportPDF() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      const lines = doc.splitTextToSize(finalLetter, 180);
      doc.text(lines, 10, 10);
      doc.save("cover_letter.pdf");
    }

    function exportWord() {
      const blob = new Blob(
        [`<html><head><meta charset='utf-8'></head><body><pre>${finalLetter}</pre></body></html>`],
        { type: "application/msword" }
      );
      saveAs(blob, "cover_letter.doc");
    }
  </script>
</body>
</html>
